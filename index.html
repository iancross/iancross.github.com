<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <title>Dynamic Size Example</title>
   <script src="https://d3js.org/d3.v4.min.js"></script>
   <style>

  /* Make the chart container fill the page using CSS. */
  #chart {
      position: fixed;
      left: 0px;
      right: 0px;
      top: 0px;
      bottom: 0px;
   }  
   svg{
      background: black
   }
   </style>
</head>

<body>
  <div id="chart"></div>

  <script>

   var chartDiv = document.getElementById("chart");
   var svg = d3.select(chartDiv).append("svg");
   var diameter = 20;
   var width,height,circles_x,circles_y;
   var node_index_queue = []
   function redraw(){


         // Extract the width and height that was computed by CSS.
         width = chartDiv.clientWidth;
         height = chartDiv.clientHeight;
         circles_x = Math.floor(width/diameter) //get number of circles that can fit across
         circles_y = Math.floor(height/diameter) //and number of circles down

         // Use the extracted size to set the size of an SVG element.
         svg
         .attr("width", width)
         .attr("height", height);

         svg.selectAll("*").remove()

         svg.selectAll("circle")
            .data(d3.range(circles_x * circles_y))
            .enter()
            .append("circle")
            .attr("transform", function translate(d,i){
               return "translate(" + (diameter * (d % circles_x) + diameter) + "," + (Math.floor(d/circles_x) * diameter + diameter) + ")"
            })
            .attr("fill", "white")
            .attr("r", diameter/2)
            .attr("stroke", "black")
            .attr("stroke-width", 2)
            .style("pointer-events", "all")
            .on("mouseover", function(d,i){
               circle_clicked(d, i, this, "red", d3.select(this).attr("fill"));
            })    
      }   
      // Draw for the first time to initialize.
      redraw();
      // Redraw based on the new size whenever the browser window is resized.
      window.addEventListener("resize", redraw);
   
      
      function circle_clicked(d,index,elem,new_color,old_color){         
         node_index_queue.push(index)

         var i = 0
         while (node_index_queue.length){ //begin our wave
            i++
            color_node_from_index(node_index_queue[0],"green",i) //first element colored
            
            get_adjacent_nodes(node_index_queue[0],old_color)
            node_index_queue.shift()
            






         }
      }

      /*function wave(wave_nodes,new_color,old_color,delay_order){
         for (var z = 0; z <= wave_nodes.length; z++){             
            svg.selectAll("circle")
               .each(function (d,i) { 
                  if (i == wave_nodes[z]){
                     console.log("here")
                     d3.select(this)
                     .transition()
                     .attr("delay", function() {return 500})
                     .attr("fill", new_color)
                     wave_nodes.splice(z,1)
                  }
               }) 
         }
         return wave_nodes
      }*/

      //returns the indices above, right, below, and left (if available)
      //basically, all indices that need to be checked against
      function get_adjacent_nodes(index,old_color){
         //if not on the far left, get the left
         var all_circles = d3.selectAll("circle")
         if (index % circles_x > 0) {

            all_circles.each(function (d,i){

               if (index-1 == i && d3.select(this).attr("fill") == old_color){
                  node_index_queue.push(index-1);
               }
            })
            
         }
         return
         /*if (index % circles_x < circles_x - 1){
            indices.push(index+1);
         } 
         if (Math.ceil(index/circles_y) > 1) {
            indices.push(index-circles_x);
         }
         if (Math.ceil(index/circles_y) < circles_y -1){
            indices.push(index+circles_x);
         } 
         //indices.push(index)

         */

      }
      function color_node_from_index(index,new_color,delay_order){
         console.log(delay_order)
         svg.selectAll("circle")
            //.transition()
            //.attr("delay", function() {return (delay_order*1000)})
            .each(function (d,i) { 
               if (i == index){
                  d3.select(this)
                  .transition()
                  .delay(function(d,i) {return (delay_order*30)})
                  //.attr("duration", function() {return delay_order*1000})
                  .attr("fill", new_color)
               }
            })
      }


   </script>
   </body>
   </html>